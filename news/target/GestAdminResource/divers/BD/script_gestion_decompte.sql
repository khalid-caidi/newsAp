-- Delete tables
drop table BON_RECEPTION
drop table ATTACHEMENT
drop table DECOMPTE
drop table BORDEREAU_PRIX
drop table MARCHE
drop table PROFIL_ROLE
drop table ROLE
drop table AUTORISATION
drop table PROFIL
drop table BON_COMMANDE
drop table SITE
drop table TERMINAL
drop table PORT
drop table UTILISATEUR
drop table Attachements_decompte

CREATE TABLE ATTACHEMENT (ID_ATTACHEMENT INT NOT NULL IDENTITY, ID_BON_COMMANDE INT, ID_DECOMPTE INT, DATE_ETABLISSEMENT DATE, DATE_DEBUT DATE, DATE_FIN DATE, FLAG_DERNIER VARCHAR(1) COLLATE French_CI_AS, MONTANT FLOAT(53), IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, NUM_ATTACHEMENT VARCHAR(20) COLLATE French_CI_AS, ID_MARCHE INT, Order_Attach NUMERIC(18,0), Order_Decompte NUMERIC(18,0), CONSTRAINT PK_ATTACHEMENT PRIMARY KEY (ID_ATTACHEMENT));
CREATE TABLE AUTORISATION (ID_AUTORISATION INT NOT NULL IDENTITY, ID_USER INT NOT NULL, ID_SITE INT NOT NULL, ID_PROFIL INT NOT NULL, CONSTRAINT PK_AUTORISATION PRIMARY KEY (ID_AUTORISATION), CONSTRAINT INDEX_UNIQUE_AUTORISATION UNIQUE (ID_USER, ID_SITE, ID_PROFIL), CONSTRAINT INDEX_UNIQUE_USER_SITE_AUTORISATION UNIQUE (ID_USER, ID_SITE));
CREATE TABLE Attachements_decompte (ID_Dec_Att NUMERIC(18,0) NOT NULL, Id_Decompte NUMERIC(18,0) NOT NULL, Id_Attachement NUMERIC(18,0) NOT NULL, Montant MONEY, CONSTRAINT PK_Attachements_decompte PRIMARY KEY (ID_Dec_Att));
CREATE TABLE BON_COMMANDE (ID_BON_COMMANDE INT NOT NULL IDENTITY, ID_SITE INT NOT NULL, NUM_BON_COMMANDE VARCHAR(50) COLLATE French_CI_AS, COD_FOURNISSEUR VARCHAR(50) COLLATE French_CI_AS NOT NULL, LIB_FOURNISSEUR VARCHAR(100) COLLATE French_CI_AS, LIB_BON_COMMANDE VARCHAR(100) COLLATE French_CI_AS, DATE_COMMANDE DATE, DEVISE VARCHAR(20) COLLATE French_CI_AS, MONTANT FLOAT(53), IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, CONSTRAINT PK_BON_COMMANDE PRIMARY KEY (ID_BON_COMMANDE));
CREATE TABLE BON_RECEPTION (ID_BON_RECEPTION INT NOT NULL IDENTITY, ID_ATTACHEMENT INT NOT NULL, DESIGNIATION_BON_RECEPTION VARCHAR(100) COLLATE French_CI_AS, DATE_COMMANDE DATE, DATE_RECEPTION DATE, DELAIS VARCHAR(50) COLLATE French_CI_AS, UNITE VARCHAR(50) COLLATE French_CI_AS, QTE FLOAT(53), PRIX_UNITAIRE FLOAT(53), MONTANT FLOAT(53), TVA FLOAT(53), MO VARCHAR(100) COLLATE French_CI_AS, OT VARCHAR(100) COLLATE French_CI_AS, IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, NUM_BON_COMMANDE VARCHAR(50) COLLATE French_CI_AS, NUM_MARCHE VARCHAR(50) COLLATE French_CI_AS, DEVISE VARCHAR(20) COLLATE French_CI_AS, NUM_BON_RECEPTION VARCHAR(50) COLLATE French_CI_AS, INVOICE VARCHAR(50) COLLATE French_CI_AS, CONSTRAINT PK_BON_RECEPTION PRIMARY KEY (ID_BON_RECEPTION));
CREATE TABLE BORDEREAU_PRIX (ID_BORDEREAU_PRIX INT NOT NULL IDENTITY, ID_MARCHE INT, DESIGNIATION VARCHAR(100) COLLATE French_CI_AS, UNITE VARCHAR(50) COLLATE French_CI_AS, QTE FLOAT(53), PRIX_UNITAIRE FLOAT(53), IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, BAR_CODE VARCHAR(20) COLLATE French_CI_AS, CDATA_VALUE VARCHAR(20) COLLATE French_CI_AS, CONSTRAINT PK_BORDEREAU_PRIX PRIMARY KEY (ID_BORDEREAU_PRIX));
CREATE TABLE DECOMPTE (ID_DECOMPTE INT NOT NULL IDENTITY, DATE_ETABLISSEMENT DATE, FLAG_DERNIER VARCHAR(3) COLLATE French_CI_AS, MONTANT_TTC FLOAT(53), RETENU_GARANTIE FLOAT(53), PENALITE_RETARD FLOAT(53), REVISION_PRIX FLOAT(53), AUTRES_RETENUES FLOAT(53), RETENUE_SOURCE FLOAT(53), IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, NUM_DECOMPTE VARCHAR(20) COLLATE French_CI_AS NOT NULL, RETENUE_AVANCE FLOAT(53), ID_MARCHE INT, Order_Decompte NUMERIC(18,0), CONSTRAINT PK_DECOMPTE PRIMARY KEY (ID_DECOMPTE));
CREATE TABLE MARCHE (ID_MARCHE INT NOT NULL IDENTITY, ID_SITE INT NOT NULL, NUM_MARCHE VARCHAR(50) COLLATE French_CI_AS NOT NULL, COD_FOURNISSEUR VARCHAR(50) COLLATE French_CI_AS NOT NULL, LIB_FOURNISSEUR VARCHAR(100) COLLATE French_CI_AS, LIB_MARCHE VARCHAR(100) COLLATE French_CI_AS, DATE_DEMARAGE DATE, DATE_FIN DATE, IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, TYPE_MARCHE VARCHAR(40) COLLATE French_CI_AS, DESCRIPTION VARCHAR(MAX) COLLATE French_CI_AS, MONTANT FLOAT(53) NOT NULL, DEVISE VARCHAR(20) COLLATE French_CI_AS, BUDGET VARCHAR(60) COLLATE French_CI_AS, FLAG_CLOTURE VARCHAR(1) COLLATE French_CI_AS DEFAULT 'N', FLAG_NANTI VARCHAR(1) COLLATE French_CI_AS DEFAULT 'N', CONSTRAINT PK_MARCHE PRIMARY KEY (ID_MARCHE), CONSTRAINT MARCHE_UNIQUE_NUM_MARCHE UNIQUE (NUM_MARCHE));
CREATE TABLE PORT (ID_PORT INT NOT NULL IDENTITY, COD_PORT VARCHAR(50) COLLATE French_CI_AS NOT NULL, LIB_PORT VARCHAR(100) COLLATE French_CI_AS NOT NULL, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, CONSTRAINT PK_PORT PRIMARY KEY (ID_PORT), CONSTRAINT INDEX_UNIQUE_COD_PORT UNIQUE (COD_PORT), CONSTRAINT INDEX_UNIQUE_LIB_PORT UNIQUE (LIB_PORT));
CREATE TABLE PROFIL (ID_PROFIL INT NOT NULL IDENTITY, COD_PROFIL VARCHAR(30) COLLATE French_CI_AS NOT NULL, LIB_PROFIL VARCHAR(100) COLLATE French_CI_AS NOT NULL, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, CONSTRAINT PK_PROFIL PRIMARY KEY (ID_PROFIL), CONSTRAINT INDEX_UNIQUE_COD_PROFIL UNIQUE (COD_PROFIL), CONSTRAINT INDEX_UNIQUE_LIB_PROFIL UNIQUE (LIB_PROFIL));
CREATE TABLE PROFIL_ROLE (ID_PROFIL INT NOT NULL, ID_ROLE INT NOT NULL, CONSTRAINT PK_PROFIL_ROLE PRIMARY KEY (ID_PROFIL, ID_ROLE));
CREATE TABLE ROLE (ID_ROLE INT NOT NULL IDENTITY, COD_ROLE VARCHAR(100) COLLATE French_CI_AS NOT NULL, LIB_ROLE VARCHAR(100) COLLATE French_CI_AS NOT NULL, NUM_ORDRE INT NOT NULL, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, CONSTRAINT PK_ROLE PRIMARY KEY (ID_ROLE), CONSTRAINT INDEX_UNIQUE_COD_ROLE UNIQUE (COD_ROLE), CONSTRAINT INDEX_UNIQUE_LIB_ROLE UNIQUE (LIB_ROLE));
CREATE TABLE SITE (ID_SITE INT NOT NULL IDENTITY, ID_TERMINAL INT NOT NULL, COD_SITE VARCHAR(50) COLLATE French_CI_AS NOT NULL, LIB_SITE VARCHAR(100) COLLATE French_CI_AS NOT NULL, COD_ISO VARCHAR(50) COLLATE French_CI_AS, IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, CONSTRAINT PK_SITE PRIMARY KEY (ID_SITE), CONSTRAINT INDEX_UNIQUE_COD_SITE UNIQUE (COD_SITE));
CREATE TABLE TERMINAL (ID_TERMINAL INT NOT NULL IDENTITY, COD_TERMINAL VARCHAR(50) COLLATE French_CI_AS NOT NULL, LIB_TERMINAL VARCHAR(100) COLLATE French_CI_AS NOT NULL, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, ID_PORT INT NOT NULL, CONSTRAINT PK_TERMINAL PRIMARY KEY (ID_TERMINAL), CONSTRAINT INDEX_COD_TERMINAL_TERMINAL UNIQUE (COD_TERMINAL));
CREATE TABLE UTILISATEUR (ID_USER INT NOT NULL IDENTITY, USERNAME VARCHAR(40) COLLATE French_CI_AS NOT NULL, PWD VARCHAR(200) COLLATE French_CI_AS NOT NULL, EMAIL VARCHAR(50) COLLATE French_CI_AS NOT NULL, PWD_RESET VARCHAR(50) COLLATE French_CI_AS, PWD_CLAIR VARCHAR(200) COLLATE French_CI_AS, IND_SUPP INT DEFAULT 1, USER_CREAT VARCHAR(20) COLLATE French_CI_AS NOT NULL, DAT_CREAT DATETIME DEFAULT getdate() NOT NULL, USER_MODIF VARCHAR(20) COLLATE French_CI_AS, DAT_MODIF DATETIME, CONSTRAINT PK_ID_USER PRIMARY KEY (ID_USER));
CREATE TABLE sysdiagrams (name SYSNAME COLLATE French_CI_AS NOT NULL, principal_id INT NOT NULL, diagram_id INT NOT NULL IDENTITY, version INT, definition VARBINARY(MAX), PRIMARY KEY (diagram_id), CONSTRAINT UK_principal_name UNIQUE (principal_id, name));
ALTER TABLE ATTACHEMENT ADD CONSTRAINT FK_ID_MARCHE_ATTACHEMENT FOREIGN KEY (ID_MARCHE) REFERENCES MARCHE (ID_MARCHE);
ALTER TABLE ATTACHEMENT ADD CONSTRAINT FK_ID_BON_COMMANDE_ATTACHEMENT FOREIGN KEY (ID_BON_COMMANDE) REFERENCES BON_COMMANDE (ID_BON_COMMANDE);
ALTER TABLE ATTACHEMENT ADD CONSTRAINT FK_ID_DECOMPTE_ATTACHEMENT FOREIGN KEY (ID_DECOMPTE) REFERENCES DECOMPTE (ID_DECOMPTE);
ALTER TABLE AUTORISATION ADD CONSTRAINT FK_ID_USER_AUTORISATION FOREIGN KEY (ID_USER) REFERENCES UTILISATEUR (ID_USER);
ALTER TABLE AUTORISATION ADD CONSTRAINT FK_ID_SITE_AUTORISATION FOREIGN KEY (ID_SITE) REFERENCES SITE (ID_SITE);
ALTER TABLE AUTORISATION ADD CONSTRAINT FK_ID_PROFIL_AUTORISATION FOREIGN KEY (ID_PROFIL) REFERENCES PROFIL (ID_PROFIL);
ALTER TABLE BON_COMMANDE ADD CONSTRAINT FK_ID_SITE_BON_COMMANDE FOREIGN KEY (ID_SITE) REFERENCES SITE (ID_SITE);
ALTER TABLE BON_RECEPTION ADD CONSTRAINT FK_ID_ATTACHEMENT_BON_RECEPTION FOREIGN KEY (ID_ATTACHEMENT) REFERENCES ATTACHEMENT (ID_ATTACHEMENT);
ALTER TABLE BORDEREAU_PRIX ADD CONSTRAINT FK_ID_MARCHE_BORDEREAU_PRIX FOREIGN KEY (ID_MARCHE) REFERENCES MARCHE (ID_MARCHE);
ALTER TABLE DECOMPTE ADD CONSTRAINT FK_ID_MARCHE_DECOMPTE FOREIGN KEY (ID_MARCHE) REFERENCES MARCHE (ID_MARCHE);
ALTER TABLE MARCHE ADD CONSTRAINT FK_ID_SITE_MARCHE FOREIGN KEY (ID_SITE) REFERENCES SITE (ID_SITE);
ALTER TABLE PROFIL_ROLE ADD CONSTRAINT FK_ID_PROFIL_PROFIL_ROLE FOREIGN KEY (ID_PROFIL) REFERENCES PROFIL (ID_PROFIL);
ALTER TABLE PROFIL_ROLE ADD CONSTRAINT FK_ID_ROLE_PROFIL_ROLE FOREIGN KEY (ID_ROLE) REFERENCES ROLE (ID_ROLE);
ALTER TABLE SITE ADD CONSTRAINT FK_ID_TERMINAL_SITE FOREIGN KEY (ID_TERMINAL) REFERENCES TERMINAL (ID_TERMINAL);
ALTER TABLE TERMINAL ADD CONSTRAINT FK_ID_PORT_TERMINAL FOREIGN KEY (ID_PORT) REFERENCES PORT (ID_PORT);
